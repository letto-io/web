var oddin=angular.module("oddin",["ui.router","ui.materialize","ngCookies","ui.mask"]);oddin.config(["$stateProvider",function(r){r.state("login",{url:"/login",templateUrl:"/partials/login",controller:"LoginController"}).state("recuperar_senha",{url:"/recuperar_senha",templateUrl:"/partials/recover-password",controller:"LoginController"}).state("redefinir_senha",{url:"/redefinir_senha",templateUrl:"/partials/redefine-password",controller:"LoginController"}).state("instructions",{url:"/disciplinas",templateUrl:"/partials/instructions",controller:"InstructionsController"}).state("presentations",{url:"/disciplinas/:instructionID/aulas",templateProvider:function(r,t){return 0==r.get("profile")?t.fromUrl("/partials/presentations-a"):1==r.get("profile")?t.fromUrl("/partials/presentations-p"):void 0},controller:"PresentationsController"}).state("avisos",{url:"/disciplinas/:disciplinaID/avisos",templateProvider:function(r,t){return 0==r.get("profile")?t.fromUrl("/partials/avisos-a"):1==r.get("profile")?t.fromUrl("/partials/avisos-p"):void 0},controller:"NoticesController"}).state("datas",{url:"/disciplinas/:disciplinaID/datas",templateProvider:function(r,t){return 0==r.get("profile")?t.fromUrl("/partials/datas-a"):1==r.get("profile")?t.fromUrl("/partials/datas-p"):void 0},controller:"DatesController"}).state("tarefas",{url:"/disciplinas/:disciplinaID/tarefas",templateProvider:function(r,t){return 0==r.get("profile")?t.fromUrl("/partials/tarefas-a"):1==r.get("profile")?t.fromUrl("/partials/tarefas-p"):void 0},controller:"WorksController"}).state("materiais",{url:"/disciplinas/:disciplinaID/materiais",templateProvider:function(r,t){return 0==r.get("profile")?t.fromUrl("/partials/materiais-a"):1==r.get("profile")?t.fromUrl("/partials/materiais-p"):void 0},controller:"MaterialsController"}).state("participantes",{url:"/disciplinas/:disciplinaID/participantes",templateUrl:"/partials/participantes",controller:"ParticipantsController"}).state("faqs",{url:"/disciplinas/:disciplinaID/faqs",templateProvider:function(r,t){return 0==r.get("profile")?t.fromUrl("/partials/faqs-a"):1==r.get("profile")?t.fromUrl("/partials/faqs-p"):void 0},controller:"FAQsController"}).state("enquetes",{url:"/disciplinas/:disciplinaID/enquetes",templateProvider:function(r,t){return 0==r.get("profile")?t.fromUrl("/partials/enquetes-a"):1==r.get("profile")?t.fromUrl("/partials/enquetes-p"):void 0},controller:"SurveysController"}).state("duvidas",{url:"/aulas/:aulaID",templateProvider:function(r,t){return 0==r.get("profile")?t.fromUrl("/partials/duvidas-a"):1==r.get("profile")?t.fromUrl("/partials/duvidas-p"):void 0},controller:"PresentationShowController"}).state("material-aula",{url:"/aulas/:aulaID/material",templateProvider:function(r,t){return 0==r.get("profile")?t.fromUrl("/partials/material-aula-a"):1==r.get("profile")?t.fromUrl("/partials/material-aula-p"):void 0},controller:"PresentationMaterialController"}).state("tarefa-status",{url:"/tarefas/:tarefaID",templateProvider:function(r,t){return 0==r.get("profile")?t.fromUrl("/partials/tarefa-status-a"):1==r.get("profile")?t.fromUrl("/partials/tarefa-status-p"):void 0},controller:"WorkShowController"}).state("admin-events",{url:"/admin-cursos",templateUrl:"/partials/admin/events",controller:"AdminEventsController"}).state("admin-lectures",{url:"/admin-disciplinas",templateUrl:"/partials/admin/lectures",controller:"AdminLecturesController"}).state("admin-users",{url:"/admin-usuarios",templateUrl:"/partials/admin/users",controller:"AdminUsersController"}).state("admin-event-show",{url:"/admin-cursos/:eventID",templateUrl:"/partials/admin/event-show",controller:"AdminEventShowController"}).state("admin-instruction-show",{url:"/admin-disciplinas-cadastradas/:instructionID",templateUrl:"/partials/admin/instruction-show",controller:"AdminInstructionShowController"}).state("admin-add-participants",{url:"/add-participants/:instructionID",templateUrl:"/partials/admin/add-participants",controller:"AdminInstructionShowController"}).state("admin-add-instructions",{url:"/add-instructions/:eventID",templateUrl:"/partials/admin/add-instructions",controller:"AdminEventShowController"})}]).run(["$window","$location","$state","$cookies",function(r,t,e,a){"/home"==r.location.pathname&&(a.get("admin")?e.go("admin-events"):e.go("instructions")),"/"==r.location.pathname&&(a.get("session")?r.location.href="/home":e.go("login"))}]),oddin.controller("LoginController",["$scope","$window","LoginAPI","$cookies","$location","$state",function(r,t,e,a,o,i){r.load=!0,r.login=function(o){r.load=!1,e.login(o).then(function(r){if(o.persist){var e=new Date;e.setMonth(e.getMonth()+1),a.put("session",a.get("session"),{expires:e})}r.data.person.admin&&a.put("admin",!0),t.location.href="/home"}).catch(function(r){401==r.status&&Materialize.toast("Usuário ou senha inválida",3e3),r.status>=500&&Materialize.toast("Erro no servidor",3e3)}).finally(function(){r.load=!0,delete r.user})},r.logout=function(){e.logout().then(function(){a.remove("session"),a.remove("profile"),a.remove("admin"),t.location.href="/"}).catch(function(){Materialize.toast("Não foi possível sair da aplicação")})},r.recoverPassword=function(t){r.load=!1,e.recoverPassword(t).then(function(){Materialize.toast("Um Email com o link para recuperação de senha será enviado para "+t.email,3e3),i.go("login")}).catch(function(){Materialize.toast("Não foi possível enviar o email de recuperação de senha",3e3)}).finally(function(){r.load=!0,delete r.user})},r.redefinePassword=function(t){return r.load=!1,t.password!==t.passwordConfirmation?(r.load=!0,delete r.user,void Materialize.toast("As senhas estão diferentes",3e3)):(t.token=o.search().token,void e.redefinePassword(t).then(function(){Materialize.toast("Senha redefinida com sucesso",3e3),i.go("login")}).catch(function(){Materialize.toast("Erro ao redefinir senha",3e3)}).finally(function(){r.load=!0,delete r.user}))}}]),oddin.factory("LoginAPI",["$http",function(r){var t=function(t){return r.post("/login",t)},e=function(){return r.post("/logout")},a=function(t){return r.post("/recover-password",t)},o=function(t){return r.post("/redefine-password",t)};return{login:t,logout:e,recoverPassword:a,redefinePassword:o}}]),oddin.directive("oddinPreloader",function(){return{replace:!0,restrict:"AE",scope:{sideBar:"@",loadVar:"="},templateUrl:"/components/preloader"}});