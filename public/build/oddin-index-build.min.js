var oddin=angular.module("oddin",["ui.router","ui.materialize","ngCookies","ui.mask"]);oddin.config(["$stateProvider",function(t){t.state("login",{url:"/login",templateUrl:"/partials/login",controller:"LoginController"}).state("recuperar_senha",{url:"/recuperar_senha",templateUrl:"/partials/recover-password",controller:"LoginController"}).state("redefinir_senha",{url:"/redefinir_senha",templateUrl:"/partials/redefine-password",controller:"LoginController"}).state("instructions",{url:"/disciplinas",templateUrl:"/partials/instructions",controller:"InstructionsController"}).state("presentations",{url:"/disciplinas/:instructionID/aulas",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/presentations/index-student"):1==t.get("profile")?r.fromUrl("/partials/presentations/index-instructor"):void 0},controller:"PresentationsController"}).state("presentation-show",{url:"/aulas/:presentationID",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/presentations/show-student"):1==t.get("profile")?r.fromUrl("/partials/presentations/show-instructor"):void 0},controller:"PresentationShowController"}).state("presentation-materials",{url:"/aulas/:presentationID/material",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/presentations/material-student"):1==t.get("profile")?r.fromUrl("/partials/presentations/material-instructor"):void 0},controller:"PresentationMaterialController"}).state("notices",{url:"/disciplinas/:instructionID/avisos",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/notices/index-student"):1==t.get("profile")?r.fromUrl("/partials/notices/index-instructor"):void 0},controller:"NoticesController"}).state("dates",{url:"/disciplinas/:instructionID/datas",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/dates/index-student"):1==t.get("profile")?r.fromUrl("/partials/dates/index-instructor"):void 0},controller:"DatesController"}).state("works",{url:"/disciplinas/:instructionID/tarefas",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/works/index-student"):1==t.get("profile")?r.fromUrl("/partials/works/index-instructor"):void 0},controller:"WorksController"}).state("work-show",{url:"/tarefas/:workID",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/works/show-student"):1==t.get("profile")?r.fromUrl("/partials/works/show-instructor"):void 0},controller:"WorkShowController"}).state("materials",{url:"/disciplinas/:instructionID/materiais",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/materials/index-student"):1==t.get("profile")?r.fromUrl("/partials/materials/index-instructor"):void 0},controller:"MaterialsController"}).state("participants",{url:"/disciplinas/:instructionID/participantes",templateUrl:"/partials/participants",controller:"ParticipantsController"}).state("faqs",{url:"/disciplinas/:instructionID/faqs",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/faqs/index-student"):1==t.get("profile")?r.fromUrl("/partials/faqs/index-instructor"):void 0},controller:"FAQsController"}).state("surveys",{url:"/disciplinas/:instructionID/enquetes",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/surveys/index-student"):1==t.get("profile")?r.fromUrl("/partials/surveys/index-instructor"):void 0},controller:"SurveysController"}).state("tests",{url:"/disciplinas/:instructionID/testes",templateProvider:function(t,r){return 0},controller:"TestsController"}).state("admin-events",{url:"/admin-cursos",templateUrl:"/partials/admin/events",controller:"AdminEventsController"}).state("admin-lectures",{url:"/admin-disciplinas",templateUrl:"/partials/admin/lectures",controller:"AdminLecturesController"}).state("admin-users",{url:"/admin-usuarios",templateUrl:"/partials/admin/users",controller:"AdminUsersController"}).state("admin-event-show",{url:"/admin-cursos/:eventID",templateUrl:"/partials/admin/event-show",controller:"AdminEventShowController"}).state("admin-instruction-show",{url:"/admin-disciplinas-cadastradas/:instructionID",templateUrl:"/partials/admin/instruction-show",controller:"AdminInstructionShowController"}).state("admin-add-participants",{url:"/add-participants/:instructionID",templateUrl:"/partials/admin/add-participants",controller:"AdminInstructionShowController"}).state("admin-add-instructions",{url:"/add-instructions/:eventID",templateUrl:"/partials/admin/add-instructions",controller:"AdminEventShowController"})}]).run(["$window","$location","$state","$cookies",function(t,r,e,o){"/home"==t.location.pathname&&(o.get("admin")?e.go("admin-events"):e.go("instructions")),"/"==t.location.pathname&&(o.get("session")?t.location.href="/home":e.go("login"))}]),oddin.controller("LoginController",["$scope","$window","LoginAPI","$cookies","$location","$state",function(t,r,e,o,i,n){t.load=!0,t.login=function(i){t.load=!1,e.login(i).then(function(t){if(i.persist){var e=new Date;e.setMonth(e.getMonth()+1),o.put("session",o.get("session"),{expires:e})}t.data.person.admin&&o.put("admin",!0),r.location.href="/home"}).catch(function(t){401==t.status&&Materialize.toast("Usuário ou senha inválida",3e3),t.status>=500&&Materialize.toast("Erro no servidor",3e3)}).finally(function(){t.load=!0,delete t.user})},t.logout=function(){e.logout().then(function(){o.remove("session"),o.remove("profile"),o.remove("admin"),r.location.href="/"}).catch(function(){Materialize.toast("Não foi possível sair da aplicação")})},t.recoverPassword=function(r){t.load=!1,e.recoverPassword(r).then(function(){Materialize.toast("Um Email com o link para recuperação de senha será enviado para "+r.email,3e3),n.go("login")}).catch(function(){Materialize.toast("Não foi possível enviar o email de recuperação de senha",3e3)}).finally(function(){t.load=!0,delete t.user})},t.redefinePassword=function(r){return t.load=!1,r.password!==r.passwordConfirmation?(t.load=!0,delete t.user,void Materialize.toast("As senhas estão diferentes",3e3)):(r.token=i.search().token,void e.redefinePassword(r).then(function(){Materialize.toast("Senha redefinida com sucesso",3e3),n.go("login")}).catch(function(){Materialize.toast("Erro ao redefinir senha",3e3)}).finally(function(){t.load=!0,delete t.user}))}}]),oddin.factory("LoginAPI",["$http",function(t){var r=function(r){return t.post("/login",r)},e=function(){return t.post("/logout")},o=function(r){return t.post("/recover-password",r)},i=function(r){return t.post("/redefine-password",r)};return{login:r,logout:e,recoverPassword:o,redefinePassword:i}}]),oddin.directive("oddinPreloader",function(){return{replace:!0,restrict:"AE",scope:{sideBar:"@",loadVar:"="},templateUrl:"/components/preloader"}});
