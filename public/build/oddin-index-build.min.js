var oddin=angular.module("oddin",["ui.router","ui.materialize","ngCookies","ui.mask"]);oddin.config(["$stateProvider",function(t){t.state("login",{url:"/login",templateUrl:"/partials/login",controller:"LoginController"}).state("recuperar_senha",{url:"/recuperar_senha",templateUrl:"/partials/recover-password",controller:"LoginController"}).state("redefinir_senha",{url:"/redefinir_senha",templateUrl:"/partials/redefine-password",controller:"LoginController"}).state("instructions",{url:"/disciplinas",templateUrl:"/partials/instructions",controller:"InstructionsController"}).state("presentations",{url:"/disciplinas/:instructionID/aulas",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/presentations/index-student"):1==t.get("profile")?r.fromUrl("/partials/presentations/index-instructor"):void 0},controller:"PresentationsController"}).state("presentation-show",{url:"/aulas/:presentationID",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/duvidas-a"):1==t.get("profile")?r.fromUrl("/partials/duvidas-p"):void 0},controller:"PresentationShowController"}).state("avisos",{url:"/disciplinas/:disciplinaID/avisos",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/avisos-a"):1==t.get("profile")?r.fromUrl("/partials/avisos-p"):void 0},controller:"NoticesController"}).state("datas",{url:"/disciplinas/:disciplinaID/datas",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/datas-a"):1==t.get("profile")?r.fromUrl("/partials/datas-p"):void 0},controller:"DatesController"}).state("tarefas",{url:"/disciplinas/:disciplinaID/tarefas",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/tarefas-a"):1==t.get("profile")?r.fromUrl("/partials/tarefas-p"):void 0},controller:"WorksController"}).state("materiais",{url:"/disciplinas/:disciplinaID/materiais",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/materiais-a"):1==t.get("profile")?r.fromUrl("/partials/materiais-p"):void 0},controller:"MaterialsController"}).state("participantes",{url:"/disciplinas/:disciplinaID/participantes",templateUrl:"/partials/participantes",controller:"ParticipantsController"}).state("faqs",{url:"/disciplinas/:disciplinaID/faqs",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/faqs-a"):1==t.get("profile")?r.fromUrl("/partials/faqs-p"):void 0},controller:"FAQsController"}).state("enquetes",{url:"/disciplinas/:disciplinaID/enquetes",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/enquetes-a"):1==t.get("profile")?r.fromUrl("/partials/enquetes-p"):void 0},controller:"SurveysController"}).state("material-aula",{url:"/aulas/:aulaID/material",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/material-aula-a"):1==t.get("profile")?r.fromUrl("/partials/material-aula-p"):void 0},controller:"PresentationMaterialController"}).state("tarefa-status",{url:"/tarefas/:tarefaID",templateProvider:function(t,r){return 0==t.get("profile")?r.fromUrl("/partials/tarefa-status-a"):1==t.get("profile")?r.fromUrl("/partials/tarefa-status-p"):void 0},controller:"WorkShowController"}).state("admin-events",{url:"/admin-cursos",templateUrl:"/partials/admin/events",controller:"AdminEventsController"}).state("admin-lectures",{url:"/admin-disciplinas",templateUrl:"/partials/admin/lectures",controller:"AdminLecturesController"}).state("admin-users",{url:"/admin-usuarios",templateUrl:"/partials/admin/users",controller:"AdminUsersController"}).state("admin-event-show",{url:"/admin-cursos/:eventID",templateUrl:"/partials/admin/event-show",controller:"AdminEventShowController"}).state("admin-instruction-show",{url:"/admin-disciplinas-cadastradas/:instructionID",templateUrl:"/partials/admin/instruction-show",controller:"AdminInstructionShowController"}).state("admin-add-participants",{url:"/add-participants/:instructionID",templateUrl:"/partials/admin/add-participants",controller:"AdminInstructionShowController"}).state("admin-add-instructions",{url:"/add-instructions/:eventID",templateUrl:"/partials/admin/add-instructions",controller:"AdminEventShowController"})}]).run(["$window","$location","$state","$cookies",function(t,r,e,a){"/home"==t.location.pathname&&(a.get("admin")?e.go("admin-events"):e.go("instructions")),"/"==t.location.pathname&&(a.get("session")?t.location.href="/home":e.go("login"))}]),oddin.controller("LoginController",["$scope","$window","LoginAPI","$cookies","$location","$state",function(t,r,e,a,o,i){t.load=!0,t.login=function(o){t.load=!1,e.login(o).then(function(t){if(o.persist){var e=new Date;e.setMonth(e.getMonth()+1),a.put("session",a.get("session"),{expires:e})}t.data.person.admin&&a.put("admin",!0),r.location.href="/home"}).catch(function(t){401==t.status&&Materialize.toast("Usuário ou senha inválida",3e3),t.status>=500&&Materialize.toast("Erro no servidor",3e3)}).finally(function(){t.load=!0,delete t.user})},t.logout=function(){e.logout().then(function(){a.remove("session"),a.remove("profile"),a.remove("admin"),r.location.href="/"}).catch(function(){Materialize.toast("Não foi possível sair da aplicação")})},t.recoverPassword=function(r){t.load=!1,e.recoverPassword(r).then(function(){Materialize.toast("Um Email com o link para recuperação de senha será enviado para "+r.email,3e3),i.go("login")}).catch(function(){Materialize.toast("Não foi possível enviar o email de recuperação de senha",3e3)}).finally(function(){t.load=!0,delete t.user})},t.redefinePassword=function(r){return t.load=!1,r.password!==r.passwordConfirmation?(t.load=!0,delete t.user,void Materialize.toast("As senhas estão diferentes",3e3)):(r.token=o.search().token,void e.redefinePassword(r).then(function(){Materialize.toast("Senha redefinida com sucesso",3e3),i.go("login")}).catch(function(){Materialize.toast("Erro ao redefinir senha",3e3)}).finally(function(){t.load=!0,delete t.user}))}}]),oddin.factory("LoginAPI",["$http",function(t){var r=function(r){return t.post("/login",r)},e=function(){return t.post("/logout")},a=function(r){return t.post("/recover-password",r)},o=function(r){return t.post("/redefine-password",r)};return{login:r,logout:e,recoverPassword:a,redefinePassword:o}}]),oddin.directive("oddinPreloader",function(){return{replace:!0,restrict:"AE",scope:{sideBar:"@",loadVar:"="},templateUrl:"/components/preloader"}});